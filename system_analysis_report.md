# ğŸ” Narutalk Sales AI ì‹œìŠ¤í…œ ë¶„ì„ ë³´ê³ ì„œ

## ğŸ“… ì‘ì„±ì¼: 2025-09-09
## ğŸ¯ ëª©ì : ì‹œìŠ¤í…œ êµ¬ì¡° íŒŒì•… ë° ê°œì„  ë°©í–¥ ì œì‹œ

---

## 1. ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ê°œìš”

### 1.1 ê¸°ìˆ  ìŠ¤íƒ
- **Backend**: Python 3.x, FastAPI, LangGraph 0.6.6, LangChain
- **Frontend**: React.js, WebSocket
- **Database**: SQLite (ì²´í¬í¬ì¸í„°), ChromaDB (ë²¡í„° ì €ì¥ì†Œ)
- **AI Model**: OpenAI GPT-4o-mini

### 1.2 ì‹œìŠ¤í…œ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     WebSocket      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Backend    â”‚
â”‚   (React)   â”‚                     â”‚  (FastAPI)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   LangGraph    â”‚
                                    â”‚    0.6.6       â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“ Backend êµ¬ì¡° ë¶„ì„

### 2.1 ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
backend/
â”œâ”€â”€ main.py                 # ì§„ì…ì 
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agents/            # ì—ì´ì „íŠ¸ ëª¨ë“ˆ (ì´ì¤‘ êµ¬í˜„ ë¬¸ì œ!)
â”‚   â”‚   â”œâ”€â”€ supervisor.py
â”‚   â”‚   â”œâ”€â”€ analytics.py
â”‚   â”‚   â”œâ”€â”€ search.py
â”‚   â”‚   â”œâ”€â”€ document.py
â”‚   â”‚   â”œâ”€â”€ compliance.py
â”‚   â”‚   â”œâ”€â”€ query_analyzer.py    # âš ï¸ ìƒˆë¡œ ì¶”ê°€
â”‚   â”‚   â”œâ”€â”€ execution_planner.py # âš ï¸ ìƒˆë¡œ ì¶”ê°€
â”‚   â”‚   â””â”€â”€ dynamic_router.py    # âš ï¸ ìƒˆë¡œ ì¶”ê°€
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ app.py         # FastAPI ì•±
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ graph.py       # ê¸°ë³¸ ê·¸ë˜í”„ êµ¬í˜„
â”‚   â”œâ”€â”€ graph/
â”‚   â”‚   â””â”€â”€ enhanced_graph.py  # âš ï¸ ê³ ë„í™”ëœ ê·¸ë˜í”„ (ì¤‘ë³µ!)
â”‚   â”œâ”€â”€ state/
â”‚   â”‚   â”œâ”€â”€ agent_state.py     # ê¸°ë³¸ ìƒíƒœ
â”‚   â”‚   â””â”€â”€ enhanced_state.py  # âš ï¸ ê³ ë„í™”ëœ ìƒíƒœ (ì¤‘ë³µ!)
â”‚   â””â”€â”€ tools/             # ë„êµ¬ ëª¨ë“ˆ
```

### 2.2 í•µì‹¬ ë¬¸ì œì 

#### ğŸ”´ **ë¬¸ì œ 1: ê·¸ë˜í”„ êµ¬í˜„ ì´ì¤‘í™”**
- `core/graph.py`: ê¸°ë³¸ supervisor ê¸°ë°˜ ê·¸ë˜í”„
- `graph/enhanced_graph.py`: query_analyzer ê¸°ë°˜ ê³ ë„í™” ê·¸ë˜í”„
- **í˜„ì¬ app.pyëŠ” ê¸°ë³¸ ê·¸ë˜í”„ë§Œ ì‚¬ìš© ì¤‘!**

#### ğŸ”´ **ë¬¸ì œ 2: Import ì˜¤ë¥˜**
```python
# enhanced_graph.pyì˜ ì˜ëª»ëœ import
from ..agents.analytics_agent import analytics_agent  # âŒ íŒŒì¼ëª… ì˜¤ë¥˜
from ..agents.search_agent import search_agent        # âŒ íŒŒì¼ëª… ì˜¤ë¥˜
from ..agents.document_agent import document_agent    # âŒ íŒŒì¼ëª… ì˜¤ë¥˜
from ..agents.compliance_agent import compliance_agent # âŒ íŒŒì¼ëª… ì˜¤ë¥˜

# ì‹¤ì œ íŒŒì¼ëª…
from ..agents.analytics import analytics_agent   # âœ…
from ..agents.search import search_agent        # âœ…
from ..agents.document import document_agent    # âœ…
from ..agents.compliance import compliance_agent # âœ…
```

#### ğŸ”´ **ë¬¸ì œ 3: ìƒíƒœ ê´€ë¦¬ í˜¼ì¬**
- `AgentState`: ê¸°ë³¸ ìƒíƒœ
- `EnhancedAgentState`: ê³ ë„í™”ëœ ìƒíƒœ
- ë‘ ìƒíƒœê°€ í˜¸í™˜ë˜ì§€ ì•ŠìŒ

#### ğŸ”´ **ë¬¸ì œ 4: WebSocket ë©”ì‹œì§€ í¬ë§· ë¶ˆì¼ì¹˜**
- Backend: `node_output`, `progress` íƒ€ì… ì „ì†¡
- Frontend: `agent_update`, `execution_plan` íƒ€ì… ê¸°ëŒ€
- ë©”ì‹œì§€ ë³€í™˜ ë¡œì§ì´ ë¶ˆì™„ì „

---

## 3. ğŸ’» Frontend êµ¬ì¡° ë¶„ì„

### 3.1 ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ChatBot.jsx      # ë©”ì¸ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ ChatHeader.jsx   # í—¤ë”
â”‚   â”‚   â”œâ”€â”€ MessageList.jsx  # ë©”ì‹œì§€ ëª©ë¡
â”‚   â”‚   â”œâ”€â”€ MessageItem.jsx  # ë©”ì‹œì§€ ì•„ì´í…œ
â”‚   â”‚   â”œâ”€â”€ ChatInput.jsx    # ì…ë ¥ì°½
â”‚   â”‚   â””â”€â”€ ProgressBar.jsx  # ì§„í–‰ í‘œì‹œ
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ websocket.js     # WebSocket í†µì‹ 
â”‚   â””â”€â”€ styles/
â”‚       â””â”€â”€ ChatBot.css      # ìŠ¤íƒ€ì¼
```

### 3.2 í•µì‹¬ ë¬¸ì œì 

#### ğŸŸ¡ **ë¬¸ì œ 1: ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬**
- 9ê°œì˜ useState í›… ì‚¬ìš©
- isPlanning, executionPhase ë“± ì¤‘ë³µëœ ìƒíƒœ

#### ğŸŸ¡ **ë¬¸ì œ 2: WebSocket ë©”ì‹œì§€ ì²˜ë¦¬**
- ë©”ì‹œì§€ íƒ€ì… ë³€í™˜ì´ websocket.jsì— í•˜ë“œì½”ë”©
- Backend ë©”ì‹œì§€ í¬ë§·ê³¼ ë¶ˆì¼ì¹˜

#### ğŸŸ¡ **ë¬¸ì œ 3: ìŠ¤í”¼ë„ˆ ë¡œì§**
- ê³„íš/ì‹¤í–‰ ë‹¨ê³„ êµ¬ë¶„ì´ ëª…í™•í•˜ì§€ ì•ŠìŒ
- agent ì´ë¦„ ê¸°ë°˜ìœ¼ë¡œë§Œ íŒë‹¨

---

## 4. ğŸš¨ ì£¼ìš” ë¬¸ì œì  ì§„ë‹¨

### 4.1 ì‹œìŠ¤í…œ í†µí•© ë¬¸ì œ
| ë¬¸ì œ | ì‹¬ê°ë„ | ì„¤ëª… |
|------|--------|------|
| ê·¸ë˜í”„ ì´ì¤‘ êµ¬í˜„ | ğŸ”´ ë†’ìŒ | ê¸°ë³¸/ê³ ë„í™” ê·¸ë˜í”„ê°€ ë³„ë„ë¡œ ì¡´ì¬í•˜ë‚˜ ì—°ê²° ì•ˆë¨ |
| Import ì˜¤ë¥˜ | ğŸ”´ ë†’ìŒ | enhanced_graph.pyê°€ ì˜ëª»ëœ íŒŒì¼ëª… ì°¸ì¡° |
| ë©”ì‹œì§€ í¬ë§· ë¶ˆì¼ì¹˜ | ğŸŸ¡ ì¤‘ê°„ | Frontend-Backend ê°„ ë©”ì‹œì§€ ê·œê²© ë¶ˆì¼ì¹˜ |
| ìƒíƒœ í˜¸í™˜ì„± | ğŸŸ¡ ì¤‘ê°„ | AgentStateì™€ EnhancedAgentState ë¹„í˜¸í™˜ |

### 4.2 ê¸°ëŠ¥ ì‘ë™ ìƒíƒœ
| ê¸°ëŠ¥ | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| ê¸°ë³¸ supervisor ë¼ìš°íŒ… | âœ… ì‘ë™ | core/graph.py ì‚¬ìš© ì‹œ |
| Query Analyzer | âŒ ë¯¸ì‘ë™ | enhanced_graph.py ë¯¸ì—°ê²° |
| Execution Planner | âŒ ë¯¸ì‘ë™ | enhanced_graph.py ë¯¸ì—°ê²° |
| Dynamic Router | âŒ ë¯¸ì‘ë™ | enhanced_graph.py ë¯¸ì—°ê²° |
| WebSocket í†µì‹  | âš ï¸ ë¶€ë¶„ì‘ë™ | ë©”ì‹œì§€ ë³€í™˜ í•„ìš” |

---

## 5. ğŸ› ï¸ ê°œì„  ë°©í–¥ ì œì•ˆ

### 5.1 ì¦‰ì‹œ ìˆ˜ì • í•„ìš” (Priority 1)

#### 1ï¸âƒ£ **Import ì˜¤ë¥˜ ìˆ˜ì •**
```python
# backend/src/graph/enhanced_graph.py ìˆ˜ì •
# Line 20-23
from ..agents.analytics import analytics_agent     # _agent ì œê±°
from ..agents.search import search_agent          # _agent ì œê±°
from ..agents.document import document_agent      # _agent ì œê±°
from ..agents.compliance import compliance_agent  # _agent ì œê±°
```

#### 2ï¸âƒ£ **ê·¸ë˜í”„ í†µí•© ë˜ëŠ” ì„ íƒ**
```python
# backend/src/api/app.py ìˆ˜ì •
# Option A: Enhanced Graph ì‚¬ìš©
from ..graph.enhanced_graph import create_enhanced_graph
sales_app = create_enhanced_graph()

# Option B: ê¸°ë³¸ ê·¸ë˜í”„ ìœ ì§€
# í˜„ì¬ ìƒíƒœ ìœ ì§€í•˜ë˜ enhanced ê¸°ëŠ¥ ì œê±°
```

#### 3ï¸âƒ£ **WebSocket ë©”ì‹œì§€ í‘œì¤€í™”**
```python
# í‘œì¤€ ë©”ì‹œì§€ í¬ë§· ì •ì˜
MESSAGE_TYPES = {
    "PLANNING": "planning",       # ê³„íš ìˆ˜ë¦½ ì¤‘
    "EXECUTING": "executing",     # ì‹¤í–‰ ì¤‘
    "AGENT_UPDATE": "agent_update",
    "COMPLETE": "complete",
    "ERROR": "error"
}
```

### 5.2 ë‹¨ê³„ë³„ ê°œì„  ê³„íš

#### **Phase 1: ì•ˆì •í™” (1-2ì¼)**
1. Import ì˜¤ë¥˜ ìˆ˜ì •
2. ê¸°ë³¸ ê·¸ë˜í”„ë¡œ í†µí•© (enhanced ì œê±° ë˜ëŠ” ìˆ˜ì •)
3. WebSocket ë©”ì‹œì§€ í¬ë§· í†µì¼

#### **Phase 2: ê¸°ëŠ¥ ë³µì› (3-4ì¼)**
1. Query Analyzer í†µí•© ê²°ì •
   - í•„ìš”í•˜ë©´ ê¸°ë³¸ ê·¸ë˜í”„ì— ì¶”ê°€
   - ë¶ˆí•„ìš”í•˜ë©´ ì™„ì „ ì œê±°
2. ìƒíƒœ ê´€ë¦¬ ë‹¨ìˆœí™”
3. Frontend ìƒíƒœ ìµœì í™”

#### **Phase 3: ìµœì í™” (5-7ì¼)**
1. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
2. ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”
3. ë¡œê¹… ì‹œìŠ¤í…œ ê°œì„ 

### 5.3 ì•„í‚¤í…ì²˜ ê°œì„ ì•ˆ

#### Option A: ë‹¨ìˆœí™” ì ‘ê·¼
```
User â†’ Supervisor â†’ Agent â†’ Response
(ê¸°ì¡´ supervisor ë°©ì‹ ìœ ì§€, enhanced ì œê±°)
```

#### Option B: ê³ ë„í™” ì ‘ê·¼
```
User â†’ Query Analyzer â†’ Planner â†’ Router â†’ Agents â†’ Response
(enhanced ë°©ì‹ ìˆ˜ì • ë° ì ìš©)
```

**ê¶Œì¥: Option Aë¡œ ë¨¼ì € ì•ˆì •í™” í›„, í•„ìš”ì‹œ Option B ì ì§„ì  ë„ì…**

---

## 6. ğŸ“‹ Action Items

### ì¦‰ì‹œ ìˆ˜í–‰
- [ ] enhanced_graph.pyì˜ import ì˜¤ë¥˜ ìˆ˜ì •
- [ ] app.pyì—ì„œ ì‚¬ìš©í•  ê·¸ë˜í”„ ê²°ì •
- [ ] WebSocket ë©”ì‹œì§€ í¬ë§· ë¬¸ì„œí™”

### ë‹¨ê¸° (1ì£¼ì¼ ë‚´)
- [ ] ë¶ˆí•„ìš”í•œ ì½”ë“œ ì œê±°
- [ ] ìƒíƒœ ê´€ë¦¬ í†µí•©
- [ ] ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‘ì„±

### ì¤‘ê¸° (2ì£¼ì¼ ë‚´)
- [ ] ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
- [ ] ì„±ëŠ¥ ìµœì í™”
- [ ] ë¬¸ì„œí™” ì™„ì„±

---

## 7. ğŸ¯ ê²°ë¡ 

í˜„ì¬ ì‹œìŠ¤í…œì€ **ê¸°ë³¸ ê¸°ëŠ¥ì€ ì‘ë™í•˜ë‚˜ ê³ ë„í™” ê¸°ëŠ¥ì´ ì—°ê²°ë˜ì§€ ì•Šì€ ìƒíƒœ**ì…ë‹ˆë‹¤.

### í•µì‹¬ ê¶Œì¥ì‚¬í•­:
1. **ë¨¼ì € ì•ˆì •í™”**: Import ì˜¤ë¥˜ ìˆ˜ì •, ê¸°ë³¸ ê·¸ë˜í”„ë¡œ í†µí•©
2. **ì ì§„ì  ê°œì„ **: ì•ˆì •í™” í›„ í•„ìš”í•œ ê³ ë„í™” ê¸°ëŠ¥ë§Œ ì„ íƒì  ë„ì…
3. **í…ŒìŠ¤íŠ¸ ìš°ì„ **: ê° ìˆ˜ì • ë‹¨ê³„ë§ˆë‹¤ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±

### ì˜ˆìƒ ì†Œìš” ì‹œê°„:
- ê¸´ê¸‰ ìˆ˜ì •: 1-2ì¼
- ì „ì²´ ì•ˆì •í™”: 1ì£¼ì¼
- ì™„ì „í•œ ê°œì„ : 2-3ì£¼ì¼

---

*ì´ ë³´ê³ ì„œëŠ” í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ ë¶„ì„ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
*ì¶”ê°€ ë¶„ì„ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ìˆìœ¼ë©´ ë§ì”€í•´ ì£¼ì„¸ìš”.*